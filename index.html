<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <!-- PWA Meta -->
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-192.png" sizes="192x192">
<link rel="icon" href="icon-512.png" sizes="512x512">
<meta name="theme-color" content="#007acc">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="WFW Linkchecker">
<link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
<!-- Service Worker aktivieren -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('serviceWorker.js').then(() => {
      console.log("âœ… Service Worker aktiv");
    });
  }
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WFW Linkchecker</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { margin: 0; font-family: "Segoe UI", sans-serif; background-color: #c7008d; color: #333; }
    .logo { text-align: center; margin-top: 30px; }
    .logo img { width: 100px; max-width: 30vw; }
    .lang-switch { text-align: center; margin: 10px; }
    .lang-switch button { background: none; border: none; font-size: 1rem; color: white; cursor: pointer; margin: 0 5px; text-decoration: underline; }
    .content-box { background: white; max-width: 700px; margin: 30px auto; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
    h1 { text-align: center; color: #007acc; font-size: clamp(1.4rem, 5vw, 2rem); margin-bottom: 1rem; }
    p { font-size: 1rem; line-height: 1.6; }
    input, button { width: 100%; padding: 0.9rem; font-size: 1rem; margin-top: 1rem; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
    button.check { background: #007acc; color: white; border: none; cursor: pointer; }
    .output, .explanation { margin-top: 1.5rem; padding: 1rem; border-radius: 6px; }
    .safe { background: #d4edda; color: #155724; }
    .warning { background: #fff3cd; color: #856404; }
    .danger { background: #f8d7da; color: #721c24; }
    .footer-link { display: block; text-align: center; color: white; text-decoration: none; margin: 30px auto 20px; font-weight: bold; font-size: 1rem; }
    #reader {
  width: 100%;
  max-width: 400px;
  margin: 30px auto;
  display: none;
  min-height: 320px; /* ğŸ‘ˆ wichtig fÃ¼r Sichtbarkeit */
  background-color: #f1f1f1; /* optional: Platzhalter-Hintergrund */
  border-radius: 10px;
}
.tabs {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 1em;
  max-width: 300px;
  margin-left: auto;
  margin-right: auto;
}
.tab-button {
  padding: 6px 10px;
  background: #eee;
  border: 1px solid #ccc;
  cursor: pointer;
  font-size: 0.9rem;
  margin: 0 2px;
  min-width: 100px;
  border-radius: 6px;
}
.tab-button.active {
  background: #007acc;
  color: white;
  font-weight: bold;
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}
  </style>
</head>
<body>
<div class="logo"><img src="WFW.jpg" alt="WFW Logo"></div>
<div class="lang-switch">
  <button onclick="setLang('de')">ğŸ‡©ğŸ‡ª</button>
  <button onclick="setLang('en')">ğŸ‡¬ğŸ‡§</button>
</div>
<div class="tabs" style="justify-content: center;">
  <button class="tab-button active" onclick="switchTab('email')">ğŸ“§ E-Mail prÃ¼fen</button>
  <button class="tab-button" onclick="switchTab('link')">ğŸ”— Link prÃ¼fen</button>
  <button class="tab-button" onclick="switchTab('header')">ğŸ•µï¸â€â™‚ï¸ Header prÃ¼fen</button>
</div>
<div class="content-box">
  <h1 id="title">ğŸ” Link-Checker â€“ Phishing erkennen</h1>
  <p id="desc">PrÃ¼fe hier anonym & sicher, ob ein Link gefÃ¤hrlich oder gefÃ¤lscht ist:</p>
  <input type="text" id="mainInput" placeholder="">
  <button class="check" onclick="handleCheck()" id="checkBtn">PrÃ¼fen</button>
  <div style="text-align:center; margin-top: 1rem;">
    <button onclick="resetForm()" style="background: #bbb; color: black;">ğŸ”„ Neue PrÃ¼fung</button>
  </div>
  <div style="text-align:center;">
    <button onclick="startQR()">ğŸ“· QR-Code scannen</button>
  </div>
  <div id="reader"></div>
  <div id="result" class="output"></div>
  <div id="explanation" class="explanation"></div>
  <div style="margin-top: 1.5rem; text-align: center;">
    <a id="helpLink" href="https://w-f-w.at/hilfe-nach-dem-klick/" target="_blank" style="color: #007acc; font-weight: bold;">
      â“ Was tun, wenn ich draufgeklickt habe?
    </a>
  </div>
</div>
<a href="https://w-f-w.at" class="footer-link">ğŸ  ZurÃ¼ck zur Startseite</a>
<script>
const texts = {
  de: {
    title: "ğŸ” Link-Checker â€“ Phishing erkennen",
    desc: "PrÃ¼fe hier anonym & sicher, ob ein Link gefÃ¤hrlich oder gefÃ¤lscht ist:",
    checkBtn: "PrÃ¼fen",
    explanation: {
      green: "âœ… Der Link scheint sicher zu sein.",
      yellow: "âš ï¸ Der Link sieht verdÃ¤chtig aus. Bitte vorsichtig sein!",
      red: "ğŸš« Achtung! Dieser Link ist gefÃ¤hrlich oder bekannt als Betrug."
    }
  },
  en: {
    title: "ğŸ” Link Checker â€“ Detect Phishing",
    desc: "Check if a link is dangerous or suspicious â€“ anonymous & free:",
    checkBtn: "Check",
    explanation: {
      green: "âœ… The link appears to be safe.",
      yellow: "âš ï¸ The link looks suspicious. Be cautious!",
      red: "ğŸš« Warning! This link is dangerous or known for fraud."
    }
  }
};

let currentLang = 'de';
function setLang(lang) {
  currentLang = lang;
  if(currentTab === 'link') {
    document.getElementById('title').innerText = texts[lang].title;
    document.getElementById('desc').innerText = texts[lang].desc;
  }
  document.getElementById('checkBtn').innerText = texts[lang].checkBtn;
}

const blacklist = [
  "banco-internet.ga", "sicher-login.top", "androidlink.cc", "win-promo.xyz", "lotto-gewinnspiel.cc"
];

async function checkUrl() {
  const url = document.getElementById("mainInput").value;
  const resultDiv = document.getElementById("result");
  const explanation = document.getElementById("explanation");
  resultDiv.innerHTML = "â³ Wird geprÃ¼ft...";
  resultDiv.className = "output";
  explanation.innerHTML = "";

  try {
    const parsedUrl = new URL(url.includes("://") ? url : "http://" + url);
    const host = parsedUrl.hostname;

    if (blacklist.some(entry => host.includes(entry))) {
      resultDiv.innerHTML = texts[currentLang].explanation.red;
      resultDiv.classList.add("danger");
      return;
    }

    // Google Safe Browsing API (API-Key anpassen!)
    const googleResult = await fetch(`https://safebrowsing.googleapis.com/v4/threatMatches:find?key=AIzaSyA0HyrC4HxtnXd11ZkJvxPVT3Q-qAdHsDQ`, {
      method: "POST",
      body: JSON.stringify({
        client: { clientId: "wfw-checker", clientVersion: "1.0" },
        threatInfo: {
          threatTypes: ["MALWARE", "SOCIAL_ENGINEERING"],
          platformTypes: ["ANY_PLATFORM"],
          threatEntryTypes: ["URL"],
          threatEntries: [{ url }]
        }
      }),
      headers: { "Content-Type": "application/json" }
    });
    const threat = await googleResult.json();
    if (threat.matches) {
      resultDiv.innerHTML = texts[currentLang].explanation.red;
      resultDiv.classList.add("danger");
      return;
    }

    // Heuristik prÃ¼fen
    const heuristics = [];
    if (url.includes("@")) heuristics.push("âš ï¸ Die URL enthÃ¤lt ein '@'.");
    if ([".ga", ".tk", ".ml", ".gq", ".xyz", ".top", ".cf"].some(tld => host.endsWith(tld)))
      heuristics.push("âš ï¸ VerdÃ¤chtige Domainendung.");
   if (host.length < 10 && !["orf.at", "tu.at", "uni.at"].includes(host)) {
  heuristics.push("âš ï¸ Sehr kurzer Domainname.");
}
    if (["android", "secure", "update", "login"].some(word => host.includes(word)))
      heuristics.push("âš ï¸ Domain enthÃ¤lt verdÃ¤chtige WÃ¶rter.");
    if (!url.startsWith("https://")) heuristics.push("âš ï¸ Keine HTTPS-Verbindung.");

    const heuristicWarnings = heuristics.map(w => `<li>${w}</li>`).join("");
    if (heuristics.length > 0) {
      resultDiv.innerHTML = texts[currentLang].explanation.yellow;
      resultDiv.classList.add("warning");
      explanation.innerHTML = "<ul>" + heuristicWarnings + "</ul>";
      return;
    }

    resultDiv.innerHTML = texts[currentLang].explanation.green;
    resultDiv.classList.add("safe");

  } catch {
    resultDiv.innerHTML = "âŒ UngÃ¼ltige URL.";
    resultDiv.classList.add("warning");
  }
}

function checkEmail() {
  const email = document.getElementById("mainInput").value;
  const resultDiv = document.getElementById("result");
  const explanation = document.getElementById("explanation");
  resultDiv.innerHTML = "";
  explanation.innerHTML = "";

  // Sehr einfache PrÃ¼fung auf gÃ¼ltiges E-Mail-Format
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    resultDiv.innerHTML = "âŒ UngÃ¼ltige E-Mail-Adresse.";
    resultDiv.className = "output warning";
    return;
  }

  // Beispielhafte einfache Blacklist
  const suspiciousDomains = [
    "spam.com", "fakeemail.org", "banned.de",
    "paypal-konto-check.com", "secure-verifikation.xyz", "bamf-support.cc",
    "login-service.tk", "deutschebank-verifizieren.com"
  ];
  const domain = email.split("@")[1].toLowerCase();
  const localPart = email.split("@")[0].toLowerCase();
  const heuristics = [];

  if (["verifizierung", "secure", "zahlung", "support", "service", "konto", "warnung", "info"].some(term => localPart.includes(term))) {
    heuristics.push("âš ï¸ VerdÃ¤chtiger Begriff im E-Mail-Namen erkannt.");
  }
  if (domain.endsWith(".tk") || domain.endsWith(".cc") || domain.endsWith(".xyz")) {
    heuristics.push("âš ï¸ VerdÃ¤chtige Domainendung.");
  }
  if (domain.includes("paypal") && !domain.endsWith("paypal.com")) {
    heuristics.push("âš ï¸ Domain enthÃ¤lt 'paypal', ist aber keine echte PayPal-Adresse.");
  }

  if (suspiciousDomains.includes(domain)) {
    resultDiv.innerHTML = "ğŸš« VerdÃ¤chtige E-Mail-Domain erkannt!";
    resultDiv.className = "output danger";
    if (heuristics.length > 0) {
      explanation.innerHTML = "<ul>" + heuristics.map(x => `<li>${x}</li>`).join("") + "</ul>" +
        "<p style='margin-top: 1em; font-weight: bold;'>â— Tipp: Wenn du eine E-Mail mit dieser Adresse bekommen hast, klicke auf keinen Link und gib keine Daten ein. Frage im Zweifel bei der offiziellen Stelle nach.</p>";
    }
    return;
  }

  if (heuristics.length > 0) {
    resultDiv.innerHTML = "âš ï¸ Die Adresse sieht verdÃ¤chtig aus.";
    resultDiv.className = "output warning";
    explanation.innerHTML = "<ul>" + heuristics.map(x => `<li>${x}</li>`).join("") + "</ul>" +
      "<p style='margin-top: 1em; font-weight: bold;'>â— Tipp: Wenn du eine E-Mail mit dieser Adresse bekommen hast, klicke auf keinen Link und gib keine Daten ein. Frage im Zweifel bei der offiziellen Stelle nach.</p>";
    return;
  }

  resultDiv.innerHTML = "âœ… Die E-Mail-Adresse sieht unverdÃ¤chtig aus.";
  resultDiv.className = "output safe";
}

function checkHeader() {
  const input = document.getElementById("mainInput").value;
  const resultDiv = document.getElementById("result");
  const explanation = document.getElementById("explanation");

  resultDiv.innerHTML = "";
  explanation.innerHTML = "";

  const warnings = [];

  // Private IPs erkennen
  if (input.includes("X-Forwarded-For")) {
    const ipMatches = input.match(/\d{1,3}(?:\.\d{1,3}){3}/g);
    if (ipMatches) {
      const privateIPs = ipMatches.filter(ip =>
        ip.startsWith("10.") ||
        ip.startsWith("192.168.") ||
        ip.startsWith("172.16.") ||
        ip.startsWith("127.")
      );
      if (privateIPs.length > 0) {
        warnings.push("âš ï¸ Header enthÃ¤lt private IP-Adressen â€“ mÃ¶glicher Spoofing-Versuch.");
      }
    }
  }

  // Typosquatting erkennen
  if (input.toLowerCase().includes("paypai.com")) {
    warnings.push("âš ï¸ MÃ¶glicherweise gefÃ¤lschte Domain erkannt: 'paypai.com'");
  }

  // Fake-Googlebot
  if (input.toLowerCase().includes("googlebot") && !input.includes("66.249.")) {
    warnings.push("âš ï¸ Gibt sich als Googlebot aus, aber IP ist nicht von Google.");
  }

  // Mehrere Received-Header aus verschiedenen LÃ¤ndern
  if ((input.match(/Received:/gi) || []).length >= 3 && input.match(/Received: from/g)) {
    warnings.push("âš ï¸ AuffÃ¤llig viele 'Received'-Header â€“ mÃ¶gliche Verschleierung der Herkunft.");
  }

  // Suspicious Return-Path
  if (input.toLowerCase().includes("return-path:") && input.match(/return-path:\s*<.*@.*>/i)) {
    const returnMatch = input.match(/return-path:\s*<(.*)>/i);
    if (returnMatch && returnMatch[1].split("@")[1] !== undefined) {
      const domain = returnMatch[1].split("@")[1].toLowerCase();
      if (domain.includes("paypal") && !domain.endsWith("paypal.com")) {
        warnings.push("âš ï¸ RÃ¼cksendeadresse enthÃ¤lt 'paypal', aber stammt nicht von paypal.com.");
      }
    }
  }

  // SPF Fail
  if (input.toLowerCase().includes("spf=fail")) {
    warnings.push("ğŸš« SPF-ÃœberprÃ¼fung fehlgeschlagen â€“ mÃ¶glicher Absender-Spoof.");
  }

  // X-Mailer als Office Outlook gefÃ¤lscht
  if (input.toLowerCase().includes("x-mailer: microsoft outlook") && input.toLowerCase().includes("php")) {
    warnings.push("âš ï¸ Header behauptet Outlook, enthÃ¤lt aber Hinweise auf PHP â€“ mÃ¶glicher Spoof.");
  }

  if (warnings.length > 0) {
    resultDiv.innerHTML = "âš ï¸ Header enthÃ¤lt verdÃ¤chtige Hinweise.";
    resultDiv.className = "output warning";
    explanation.innerHTML = "<ul>" + warnings.map(x => `<li>${x}</li>`).join("") + "</ul>";
  } else {
    resultDiv.innerHTML = "âœ… Keine AuffÃ¤lligkeiten im Header erkannt.";
    resultDiv.className = "output safe";
  }
}

function handleCheck() {
  if(currentTab === 'email') {
    checkEmail();
  } else {
    checkUrl();
  }
}

function startQR() {
  const readerDiv = document.getElementById("reader");
  readerDiv.style.display = "block";

  const qr = new Html5Qrcode("reader");
  qr.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (decodedText) => {
    document.getElementById("mainInput").value = decodedText;
    qr.stop().then(() => {
      readerDiv.style.display = "none";
      checkUrl();
    });
  }, console.warn);

 // ğŸ“¦ Jetzt mit Fenster-Scroll per offsetTop
  setTimeout(() => {
    window.scrollTo({
      top: readerDiv.offsetTop - 50,
      behavior: "smooth"
    });
  }, 300);
}

let currentTab = 'email';
function switchTab(tab) {
  currentTab = tab;
  const title = document.getElementById("title");
  const desc = document.getElementById("desc");
  const input = document.getElementById("mainInput");
  const checkBtn = document.getElementById("checkBtn");
  const explanation = document.getElementById("explanation");
  const result = document.getElementById("result");
  const helpLinks = {
    email: "https://w-f-w.at/hilfe-bei-e-mail-betrug/",
    link: "https://w-f-w.at/hilfe-nach-dem-klick/",
    header: "https://w-f-w.at/header-pruefen/"
  };

  document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
  if (tab === 'email') {
    title.innerText = "ğŸ“§ E-Mail-Adresse prÃ¼fen";
    desc.innerText = "PrÃ¼fe hier anonym & sicher, ob eine E-Mail-Adresse verdÃ¤chtig ist:";
    input.placeholder = "z.â€¯B. hilfe@bamf.de";
    input.value = "";
    checkBtn.setAttribute("onclick", "checkEmail()");
    document.querySelector(".tab-button:nth-child(1)").classList.add("active");
  } else if (tab === 'header') {
    title.innerText = "ğŸ•µï¸â€â™‚ï¸ HTTP-Header analysieren";
    desc.innerText = "FÃ¼ge hier Header-Zeilen (z.â€¯B. aus einer E-Mail) ein:";
    input.placeholder = "z.â€¯B. X-Forwarded-For: 127.0.0.1, 1.2.3.4";
    input.value = "";
    checkBtn.setAttribute("onclick", "checkHeader()");
    document.querySelector(".tab-button:nth-child(3)").classList.add("active");
  } else {
    title.innerText = texts[currentLang].title;
    desc.innerText = texts[currentLang].desc;
    input.placeholder = "https://example.com";
    input.value = "";
    checkBtn.setAttribute("onclick", "checkUrl()");
    document.querySelector(".tab-button:nth-child(2)").classList.add("active");
  }

  result.innerHTML = "";
  result.className = "output";
  explanation.innerHTML = "";

  document.getElementById("helpLink").href = helpLinks[tab];
}

// Standard: Nur E-Mail-Tab anzeigen
window.onload = () => {
  switchTab('email');
};

function resetForm() {
  document.getElementById("mainInput").value = "";
  document.getElementById("result").innerHTML = "";
  document.getElementById("result").className = "output";
  document.getElementById("explanation").innerHTML = "";
}

</script>

<div id="link-tab" class="tab-content">
  <h2>ğŸ”— Link prÃ¼fen</h2>
  <input type="text" id="linkInput" placeholder="z.â€¯B. https://example.com">
  <button onclick="checkLink()">PrÃ¼fen</button>
  <div id="linkResult"></div>
</div>
</body>
</html>
